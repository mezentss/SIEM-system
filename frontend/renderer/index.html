<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Система мониторинга SIEM</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="topbar-title">Система мониторинга SIEM</div>
      <nav class="topbar-nav" aria-label="Навигация">
        <button class="topbar-nav-item topbar-nav-item-active" data-view="dashboard" type="button">Панель</button>
        <button class="topbar-nav-item" data-view="map" type="button">Карта</button>
        <button class="topbar-nav-item" data-view="reports" type="button">Отчёты</button>
        <button class="topbar-nav-item" data-view="settings" type="button">Настройки</button>
        <button class="topbar-nav-item" data-view="employee" type="button">Сотрудник</button>
      </nav>
      <div class="topbar-user">
        <span class="topbar-user-label">Пользователь:</span>
        <span id="topbarUsername" class="topbar-user-name">—</span>
        <span id="topbarRole" class="topbar-role">—</span>
        <button id="logoutBtn" class="topbar-logout">Выход</button>
      </div>
    </div>
  </div>

  <div class="container">

    <div id="mainView" class="view">
      <main>
        <!-- Event type statistics -->
        <section class="event-types-stats" aria-label="Статистика по типам событий">
          <h3>События по типам</h3>
          <div id="eventTypesContainer" class="event-types-chart"></div>
        </section>

        <!-- Dashboard view -->
        <div id="dashboardView" class="view-content">
          <div class="controls">
            <button id="loadEventsBtn" data-require-admin>Загрузить события</button>
            <button id="runAnalysisBtn" data-require-admin>Запустить анализ</button>
            <button id="generateMockBtn" data-require-admin>Собрать события из файла</button>
          </div>

          <section class="stats-grid" aria-label="Ключевые показатели">
            <div class="stat-card">
              <div class="stat-label">Событий всего</div>
              <div id="statTotalEvents" class="stat-value">—</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Активных инцидентов</div>
              <div id="statActiveIncidents" class="stat-value">—</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Инцидентов сегодня</div>
              <div id="statAlertsToday" class="stat-value">—</div>
            </div>
            <div class="stat-card">
              <div class="stat-label">Состояние системы</div>
              <div id="statSystemHealth" class="stat-value stat-health">—</div>
            </div>
          </section>

          <section class="panel-grid" aria-label="Панель мониторинга">
            <section id="dashboardSection" class="panel">
              <div class="panel-header">
                <h2>Инциденты по серьёзности</h2>
              </div>
              <p class="section-hint">Данные обновляются каждые 10 секунд. Нажмите на сектор диаграммы или пункт легенды, чтобы открыть список инцидентов с описанием ошибки, приложением и временем обнаружения.</p>
              <div id="chartContainer" class="chart-container"></div>
            </section>

            <section class="panel">
              <div class="panel-header">
                <h2>События по уровням за последние 24 часа</h2>
              </div>
              <canvas id="eventsByHourChart" width="800" height="260"></canvas>
              <div class="events-chart-legend">
                <span class="legend-dot legend-critical"></span><span>Критический</span>
                <span class="legend-dot legend-high"></span><span>Высокий</span>
                <span class="legend-dot legend-medium"></span><span>Средний</span>
                <span class="legend-dot legend-low"></span><span>Низкий</span>
              </div>
            </section>
          </section>

          <!-- Recent events table -->
          <section class="panel" data-require-admin>
            <div class="panel-header">
              <h2>Недавние события</h2>
            </div>
            <div class="events-table-container">
              <table class="events-table">
                <thead>
                  <tr>
                    <th>Время</th>
                    <th>Тип</th>
                    <th>Серьёзность</th>
                    <th>Источник</th>
                    <th>Статус</th>
                  </tr>
                </thead>
                <tbody id="recentEventsList"></tbody>
              </table>
            </div>
          </section>

          <section class="panel-grid panel-grid-bottom" aria-label="История и журнал" data-require-admin>
            <section class="panel">
              <div class="panel-header">
                <h2>Последние события</h2>
              </div>
              <div id="eventsHistory" class="history-list"></div>
            </section>

            <section class="panel">
              <div class="panel-header">
                <h2>Уведомления</h2>
              </div>
              <div id="notificationsHistory" class="history-list"></div>
            </section>
          </section>
        </div>

        <!-- Reports view -->
        <div id="reportsView" class="view-content hidden">
          <section class="panel">
            <div class="panel-header">
              <h2>Отчёты</h2>
            </div>
            <p>Раздел в разработке...</p>
          </section>
        </div>

        <!-- Settings view -->
        <div id="settingsView" class="view-content hidden">
          <section class="panel">
            <div class="panel-header">
              <h2>Настройки</h2>
            </div>
            <p>Раздел в разработке...</p>
          </section>
        </div>

        <!-- Employee view -->
        <div id="employeeView" class="view-content hidden">
          <section class="panel">
            <div class="panel-header">
              <h2>Информация для сотрудника</h2>
            </div>
            <p>Текущий статус системы и рекомендации по безопасности.</p>
          </section>
        </div>

        <!-- Map view -->
        <div id="mapView" class="view-content hidden">
          <section class="panel">
            <div class="panel-header">
              <h2>Карта приложений с ошибками</h2>
            </div>
            <p class="section-hint">Визуализация приложений и служб, в которых происходят сбои. Размер круга показывает количество ошибок.</p>
          </section>
          
          <section class="panel">
            <div class="panel-header">
              <h2>Приложения</h2>
            </div>
            <div id="appsMapContainer" class="apps-map-container"></div>
          </section>
          
          <section class="panel">
            <div class="panel-header">
              <h2>Последние ошибки приложений</h2>
            </div>
            <div class="events-table-container">
              <table class="events-table">
                <thead>
                  <tr>
                    <th>Время</th>
                    <th>Приложение</th>
                    <th>Ошибка</th>
                    <th>Серьёзность</th>
                  </tr>
                </thead>
                <tbody id="appErrorsList"></tbody>
              </table>
            </div>
          </section>
        </div>
      </main>
    </div>

    <div id="detailView" class="detail-overlay hidden" aria-hidden="true">
      <main class="detail-page">
        <div class="detail-top">
          <button id="backToChartBtn" type="button" class="btn-back">← Назад к панели</button>
          <div class="detail-breadcrumbs" id="detailBreadcrumbs">Панель / Инциденты</div>
        </div>

        <div class="detail-title-row">
          <h2 id="drilldownTitle" class="detail-title">Инциденты</h2>
          <div class="detail-search">
            <input id="detailSearchInput" type="search" placeholder="Поиск по описанию или службе" />
          </div>
        </div>

        <div class="detail-tabs" role="tablist" aria-label="Фильтр по серьёзности">
          <button id="tabCritical" class="detail-tab" type="button" data-severity="critical">Критические</button>
          <button id="tabHigh" class="detail-tab" type="button" data-severity="high">Высокие</button>
          <button id="tabMedium" class="detail-tab" type="button" data-severity="medium">Средние</button>
          <button id="tabLow" class="detail-tab" type="button" data-severity="low">Низкие</button>
        </div>

        <section class="panel detail-panel">
          <div class="detail-table-wrap">
            <table class="detail-table">
              <thead>
                <tr>
                  <th>Дата</th>
                  <th>Время</th>
                  <th>Тип</th>
                  <th>Серьёзность</th>
                  <th>Приложение/служба</th>
                  <th>Описание</th>
                </tr>
              </thead>
              <tbody id="drilldownList"></tbody>
            </table>
          </div>
          <div id="drilldownEmpty" class="drilldown-empty hidden">Нет инцидентов в этой категории.</div>
        </section>
      </main>
    </div>

    <div id="toastContainer" class="toast-container" aria-live="polite"></div>
  </div>

  <script src="renderer.js"></script>
</body>
</html>